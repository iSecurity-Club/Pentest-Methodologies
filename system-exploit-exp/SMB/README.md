# 渗透测试方法论——SMB

## 0x0 SMB 版本漏洞


| 版本            | EXP                 | 备注                   |
|---------------|---------------------|----------------------|
| Windows SMBv1 | ms17-010 |  |
|  |   |                      |
|               |                     |                      |


---

## 0x1 SMB 和 Samba 的区别

在 windows 上叫做 SMB，后来在 linux 上移植了该服务，就叫做 samba 服务。

**SMB协议是基于TCP—NETBIOS下的，一般使用端口是139,445。**

如果某个漏洞影响的是 samba，那么 Windows 是不受影响的。

通过 NetBIOS 扫描网络中所有提供 SMB 服务的主机：

```
nbtscan -r 192.168.0.1/24
```

## 0x2 获取 SMB 版本信息
- nmap

```
nmap -v -sV -p 139,445 <IP>
```

若 nmap 无法获取，尝试 msf

- msf

```
use auxiliary/scanner/smb/smb_version
```


## 0x3 SMB 弱口令

| 用户名                   | 密码                                   |
|----------------------|---------------------------------------|
| 空                   | 空                                     |
| guest                | 空                                     |
| Administrator, admin | \(空\), password, administrator, admin |
| arcserve             | arcserve, backup                      |
| tivoli, tmersrvd     | tivoli, tmersrvd, admin               |
| backupexec, backup   | backupexec, backup, arcada            |
| test, lab, demo      | password, test, lab, demo             |

## 0x4 使用工具扫描

### nmap

```
nmap --script smb-* -vv -p 139,445 <IP>
```

### enum4linux 

```
enum4linux -a [-u "<username>" -p "<passwd>"] <IP>
```

### smbmap

```
smbmap -u <USER> -p <PASSWORD>  -H 10.11.1.31
```
如果想测试匿名登录或任意用户登录：
```
smbmap -u kali -p ""  -H 10.11.1.31
smbmap -u "" -p ""  -H 10.11.1.31
```
### smbclient
```
#-L 表示列举出所有目录，但不进入目录
# 空密码登录
smbclient -L 10.11.1.31 

# 空用户登录
smbclient -L 10.11.1.31 -U ""

# 指定分享目录
smbclient //10.11.1.31/wwwroot -U "kali"
```
如果 smbmap 能够看到 smb 信息，但是smbclient 无法连接，试试：
```
smbclient -L //10.11.1.136/ --option='client min protocol=NT1' -N
```

